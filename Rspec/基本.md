# Rspecについて
railsは標準でMinitestというテストがついているが、railsでテストを行うときはRspecを使う方が多い。
仕様書（spec）を書く感覚で書いてみる。様々なテストがあるが、もっとも重要なのは、**システムテスト**になる。

### セットアップ方法
- gemfileに追加する。
```
group :development, :test do
  gem 'rspec-rails', '~> 3.6.0'
  # Rails で元から追加されている gem は省略
end
```

- ```rails g rspec:install```でインストール。これによりspecディレクトリが作成される。

### 基本的な文法

- テストコードの整理・分類する -> **describe, context**

#### describe
**「何について使用を記述しようとしているかを記述する（テストの対象）」**  
一番外側の部分になり、この中にテストの本体を記述する。

#### context
テストの内容を **「状況・状態」のバリデーションごとに分類する時に使う。**  
ユーザーがログインしているかどうか、管理者ユーザーかどうか、など状況ごとにきり分けて書く。


- テストコードを実行する -> **before, it**

#### before
**「前提条件」を書く。** テストコードが実行される前に、beforeの中のコードが実行される。予め、beforeに処理をまとめておくことで、DRYの原則を守
ことができる。

#### it
**「期待する動作」を書く。** この中に書かれたテストコードが想定どうりに動くことで、エラーが存在しないことが確認できる。
Specが例外が出ればエラー（error）、そうではないが想定と違う場合は失敗（failure）が出力される。


### Rails文法
everyday railsで、
```
scope :search, ->(term) {
    where("LOWER(message) LIKE ?", "%#{term.downcase}%")
  }
```
というscopeがモデルファイルに書かれていた。このscopeはコントローラーで使用できるメソッドを作成するものであり、データベースの処理をまとめることができる。

```where("LOWER(message) LIKE ?", "%#{term.downcase}%")```の意味は、小文字にしたmessageカラムと、受け取った引数とのlike検索をしている。
**SQL関数が入っているので少し分かりづらい。**
