# テーブル結合  

テーブル結合はとても大事らしいので、しっかりとまとめようと思う。  

RDBでは、複数のテーブルに分けてデータを管理しているので、複数のテーブルから出力したい結果があるなら**テーブルの結合**をしないといけない。  

テーブルの結合では**次の二つ**を行っている。  
- 全ての組み合わせを生成する。  
- 条件にあった組み合わせだけを選ぶ。  

つまり、**全ての組み合わせを生成した後に、条件にあった組み合わせを選んでいるということになる。**  

例えば、4行あるテーブルと７行あるテーブルを組み合わせると、４*７＝２８通りの組み合わせができる。そこから、条件にあったデータだけを取ってくる
ということである。  

## join演算子  
テーブルの結合はwhere句でもできるが、行の選択条件と同じように見えてしまい見にくくなるため**joinを使う。**  
```
select * 
from movies m 
join characters c 
on m.movie_id = c.movie_id
where c.gender = 'F';
```
こうすることで、テーブルの結合をjoin演算子にまとめることができる。on以降で結合条件の指定をする。また、テーブル名にエイリアスをつけることができる。  

**テーブル結合はサブクエリでも書くことができる**  
- テーブル結合  
```
select c.*
from characters c
join movies m on c.movie_id = m.movie_id
where m.title = 'となりのトトロ' order by c.id;
```
- サブクエリ  
```
select c.*
from characters c 
where c.movie_id in (select m.movie_id from movies m where m.title = 'となりのトトロ')
order by c.id;
```
どちらも実行結果は同じになる。どちらでもかけるようにした方がいい。  


## using  

テーブル結合の条件は、**「on」**を使って指定していたが**using**を使って指定することもできる。  

usingには次のような制限がある。  
- 「on」では演算子（＝など）が使えるが、「using」では使えない。  
- 「on」では名前が違う列を使って結合できるが、「using」では同じ名前の列同士でしか結合できない。
 
上級者は、usingを好むらしい。
