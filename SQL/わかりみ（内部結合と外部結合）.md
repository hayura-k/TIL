# テーブル結合の注意点  

テーブルを結合すると、存在しているのに表示されないデータが出てくる。**結合条件に当てはまらなかったデータは、表示されないため。**

# 内供結合と外部結合  

それでも結合条件に当てはまらないデータを取り出したい時にjoinの代わりに**left join**などを使う。  
内部や外部といった言い方は、ベンずの考え方からなる。

## 結合の種類  

テーブルの結合は次の４種類に分けることができる。  
- 内部結合 ... 左右のテーブルから対応する組み合わせだけを選ぶ。これまでやってきた結合である。  
- 左外部結合（left outer join） ... 対応する組み合わせに加えて、**左側のテーブルから、対応しない行も取り出す**。
- 右外部結合（right outer join） ... 対応する組み合わせに加えて、**右側のテーブルから、対応しない行も取り出す**。
- 完全外部結合(full outer join) ... 対応する組み合わせに加えて、**左右のテーブルから、対応しない行も取り出す**。  

## 左外部結合  
**left outer join** または **left join**を使う。  
```
select m.*, c.*
from movies m 
left outer join characters c
on m.movie_id = c.movie_id
order by m.movie_id, c.id;
```
この場合は、moviesテーブルから対応しない行も取り出す。  

## 右外部結合  
**right outer join** または**right join**を使う。  
```
select m.*, c.*
from movies m 
right outer join characters c
on m.movie_id = c.movie_id
order by m.movie_id, c.id;
```
この場合は、右側のcharactersテーブルから、対応しない行も取り出す。  

## 完全外部結合  
```
select m.*, c.*
from movies m 
full outer join characters c
on m.movie_id = c.movie_id
order by m.movie_id, c.id;
```
対応する組み合わせと、左右のテーブルから、対応しない行を取り出す。

この他のも**クロス結合**というのがある。これは結合条件がないので、全ての値の組み合わせが出てくる。片方のテーブルが１行のみの場合などに有効。  

## テーブル結合によるフィルタ  

テーブル結合は、条件による選択が含まれるため結果として、**フィルタ**としての機能を持つ。  
- 内部結合 ... 条件にあった行だけを選ぶ。
- 外部結合 ... 条件にあった行を取り除く。  

分かりづらかった外部結合を説明する。  
```
select m.*, c.*
from movies m 
left outer join characters c
on m.movie_id = c.movie_id
order by m.movie_id, c.id;
```
例えばこのクエリによって、このようなデータが出力される。
|movie_id | title | id | movie_id | name | gender |
|---------|-------|----|----------|------|--------|
|93 | 風の谷のナウシカ | 401 |93|ナウシカ|F |
|94 | 天空の城ラピュタ | 402 |94|パズー |M |
|94 | 天空の城ラピュタ | 403 | 94|シータ |F |
|94 | 天空の城ラピュタ | 404 | 94|ムスカ |M |
|95 | となりのトトロ | 405 | 95 | さつき |F |   
|95 | となりのトトロ | 406 | 95 | メイ | F |
|96 | 崖の上のポニョ |   |      |     |    |

ここで、キャラクターがnullである組み合わせを選べば、出演キャラクターのない映画(崖の上のポニョ)を選ぶことができる。  
