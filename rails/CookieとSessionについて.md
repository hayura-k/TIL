# CookieとSession

初心者の壁とも言えるログイン機能。自分は、5か月間くらい勉強しながらも理解が曖昧なままだったので
きれいにまとめた。

### そもそもなんでCookieやSessionがいるのか？  
HTTP通信はそもそもステートレスな通信なので、次のリクエストに行く際に前のリクエストの情報を保持することが出来ない。  
なので、そのままではECサイトのカート機能とか、ログイン機能とかがつかえない。  
この問題を解決する手段がCookieとSessionになる。


### Cookie  
まずクッキーとはなんだろうか？Webサーバーはレスポンスを返すときに、そのサーバー情報をクッキー内に保存してブラウザに送る。
そして、ブラウザがサーバにクッキー情報を送ることでサーバ側は「あのブラウザだ！」と識別することができる。
大事なのは、<strong>クッキーはブラウザに保存されるということだ。</strong>
クッキーは送られる際、HTTP通信のメッセージヘッダの中に書き込まれて送られる。


### Session  
次に、Sessionとはなんだろうか？Sessionは状態を維持するための仕組みである。流れは、レスポンスの際にクッキーの中にSessionIDを書き込みブラウザにおくる。＝＞POSTリクエストがおくられ、```session[:user_id] = @user.id```など任意のキーにユーザー情報を保存する。＝＞その情報をクッキー内のSessionIDと結びつける。＝＞レスポンスする。（クッキー情報もおくる。）＝＞ログインした後の画面にリクエストが送られる。＝＞クッキー情報の中のSessionIDをWebサーバーが認識し、それに紐づいたセッションデータを渡す。＝＞ユーザー情報を保持したまま操作できる！  
流れとしてはこんな感じだ。この「状態」はブラウザが閉じられるまでは、保持され続ける。
<strong>セッションデータは、サーバー側に保存される。</strong>
