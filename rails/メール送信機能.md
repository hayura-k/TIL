# メール送信機能  

サインアップ、パスワード忘れの対応、各種の通知という用途の際にメール送信の機能が利用される。
Rails では、メールを送るシステムを**Action Mailer**を使い実装している。

## 作成の流れ  

1. ジェネレーターを使い、メイラーを作成する。  

2. メイラーにメソッドを追加  
メイラーはコントローラーと似ているため、テンプレートを通じてメールを作成・送信してくれる。
メイラーにメソッドを書くことで、テンプレートからそのメソッドを使うことができる。
```rb
def creation_email(task)
  @tasl = task
  mail(
    subject: 'タスク作成',
    to: 'user@example.com',
    from: 'taskleaf@example.com'
  )
end
```
このメソッドは、引数taskを受け取り、テンプレートで使うために、インスタンス変数に代入する。  
その後は、mailメソッドを使いメールのsubject（タイトル）,to（宛先）,from（送信者）を作成する。

テンプレートファイルでは、受信者の環境に配慮して、html型式と、text型式の２種類のテンプレートを用意する。

3.メール送信処理  
保存したタスクをメールを送れるようにするため、createアクションにメールを送る処理を書く。
```rb
def create
  if @task.save
    TaskMailer.creation_email(@task).deliver_now
    省略
  else
    省略
  end
end
```
deliver_nowメソッドは即時送信を送るためのメソッドである。

これで、実装完了。
流れをまとめると、**メイラー作成 => メイラーにメールを送るためのメソッドを実装 => 
テンプレートを実装（html,textの両型式を実装） => コントローラーに処理を書く**

テストが難しいなと思った。重要な機能だと思うから、自分でも作って見て覚えたい。
