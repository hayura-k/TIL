# ログイン機能実装までの道

- ログイン機能は苦手なところなので、頑張ってアウトプットしようと思う。
- ここでは簡単に言うとログイン機能は、CookieがsessionIDを運ぶことで実現する。

### ログイン機能実装の最初
Railsでログイン機能を実装する際は、ログインをする＝**sessionというリソースを作る**と言うことなので、SessionsController
と言う名前でコントローラーを作る。アクションは次の3つを追加する。  
| アクション内容 |HTTPメソッド | URL|アクション名|
|--------------|-----------|----|----------|
|ログインのフォーム表示| GET | /login| new |
|ログインを行う | POST | /login | create |
|ログアウト | DELEE | /logout| destroy |

### フォーム実装  
まずはコントローラーを作ろー。  
```rails g Controller Sessions new ```  
次はルーティングを書く。  

ログインページのフォームが重要！  
```form_with scope: :session, local: true do |f|```
rails5.1以降ではform_withが推奨されているので、form_withを使う。通常の場合、```form_with model: @user, local: true do |f|```
と書くが、ログイン機能の場合はデータを保存したりするわけではないので、モデルがなく、同じようにはかけない。

また**scope: :session**と書くことで、name属性のプレフィックスとなる。
試しにscope: :sessionがない場合のhtml  
 ```html
 <label for="email">
 <input name="email" type="email" id= "email">
 ``` 
 となる。
今回は、sessionリソースを渡したいので ***name=[:session][:email]*** としたい。そのためにもscope: :sessionと書くことが必要だ。

### ログイン実行  
- まずルーティング設定。  
- crateアクションを追加。ここで重要なのが、***ユーザーIDをセッションIDに入れておくことだ。***  
```rb
def create
  user = User.find_by(email: params[:session][:email])

  if user&.authenticate(params[:session][:password])
    session[:user_id] = user.id
    redirect_to root_url, notice: 'ログインしました'
  else
    render :new
  end
end
```
ここでは、まずフォームから送られてきたemailを使いユーザーを検索してみる。

続きは明日〜
